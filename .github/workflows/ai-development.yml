name: AI Development Workflow

on:
  repository_dispatch:
    types: [linear_issue_labeled]

jobs:
  ai-development:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install anthropic requests
      
      - name: Run AI Development Script
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          LINEAR_ISSUE_ID: ${{ github.event.client_payload.issue_id }}
          LINEAR_ISSUE_TITLE: ${{ github.event.client_payload.issue_title }}
          LINEAR_ISSUE_DESCRIPTION: ${{ github.event.client_payload.issue_description }}
          LINEAR_ISSUE_IDENTIFIER: ${{ github.event.client_payload.issue_identifier }}
        run: |
          python .github/scripts/ai_developer.py
      
      - name: Create Pull Request
        if: success()
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "AI: Implement ${{ github.event.client_payload.issue_title }}"
          branch: feature/ai-${{ github.event.client_payload.issue_identifier }}
          delete-branch: true
          title: "[AI] ${{ github.event.client_payload.issue_title }}"
          body: |
            ü§ñ **AI-Generated Pull Request**
            
            This PR was automatically generated by Claude AI in response to Linear issue.
            
            **Linear Issue:** ${{ github.event.client_payload.issue_identifier }}
            **Title:** ${{ github.event.client_payload.issue_title }}
            
            ## Description
            ${{ github.event.client_payload.issue_description }}
            
            ## ‚ö†Ô∏è Review Required
            This is AI-generated code. Please review carefully before merging:
            - [ ] Code meets requirements
            - [ ] No security issues
            - [ ] No unintended changes
            - [ ] Tests pass (if applicable)
            
            ---
            *Generated by GitHub Actions AI Development Workflow*
          draft: true
          labels: |
            ai-generated
            needs-review